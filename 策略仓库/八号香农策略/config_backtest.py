# -*- coding: utf-8 -*-
"""
8å·é¦™å†œç­–ç•¥ - å›æµ‹ä¸“ç”¨é…ç½®

ä½¿ç”¨æ–¹æ³•ï¼š
    1. ä¿®æ”¹ä¸‹é¢çš„å‚æ•°
    2. è¿è¡Œ backtest.py å³å¯

å‚æ•°è¯´æ˜ï¼š
    - vol_short_window: çŸ­æœŸæ³¢åŠ¨ç‡çª—å£ï¼ˆåˆ†é’Ÿï¼‰ï¼Œè¶Šå°å¯¹æ³¢åŠ¨è¶Šæ•æ„Ÿ
    - vol_long_window: é•¿æœŸæ³¢åŠ¨ç‡çª—å£ï¼ˆåˆ†é’Ÿï¼‰ï¼Œä½œä¸ºåŸºå‡†
    - target_ratio: ç›®æ ‡æŒä»“æ¯”ä¾‹ï¼Œ0.5 = 50%æŒä»“50%ç°é‡‘
    - grid_width_base: åŸºç¡€ç½‘æ ¼å®½åº¦ï¼Œè¶Šå¤§äº¤æ˜“è¶Šå°‘
"""

# ==================== å›æµ‹å‚æ•°é…ç½® ====================

# ğŸ“Š æ³¢åŠ¨ç‡å¼•æ“å‚æ•°
vol_short_window = 60       # çŸ­æœŸæ³¢åŠ¨ç‡çª—å£ (åˆ†é’Ÿ) - æ¨è 30-240
vol_long_window = 2880      # é•¿æœŸæ³¢åŠ¨ç‡çª—å£ (åˆ†é’Ÿ) - æ¨è 720-2880
vol_ewma_alpha = 0.05       # EWMA å¹³æ»‘ç³»æ•°

# ğŸ¯ æ ¸å¿ƒç­–ç•¥å‚æ•°
target_ratio = 0.5          # ç›®æ ‡æŒä»“æ¯”ä¾‹ (å›ºå®š 0.5 = 50% ETH + 50% ç°é‡‘)
                            # âš ï¸ é¦™å†œç­–ç•¥æ ¸å¿ƒé€»è¾‘ï¼šå¿…é¡»ä¿æŒ 50/50 å¹³è¡¡ï¼Œä¸å¯ä¿®æ”¹

# ä¸å®ç›˜ç»Ÿä¸€çš„ç½‘æ ¼å®½åº¦å‚æ•°
vol_k_factor = 1.0          # æ³¢åŠ¨ç‡Kç³»æ•° (ç½‘æ ¼å®½åº¦ = EWMA_Vol * K)
                            # ğŸ’¡ è¶Šå¤§ = ç½‘æ ¼è¶Šå®½ï¼Œäº¤æ˜“è¶Šå°‘
                            # æ¨è: 0.8-1.5

# ğŸ“ˆ çŠ¶æ€åˆ‡æ¢é˜ˆå€¼
regime_spike_threshold = 1.5  # æ³¢åŠ¨ç‡æ¯”ç‡ > 1.5 è¿›å…¥ Spike æ¨¡å¼
regime_crush_threshold = 0.5  # æ³¢åŠ¨ç‡æ¯”ç‡ < 0.5 è¿›å…¥ Crush æ¨¡å¼

# ğŸ›ï¸ çŠ¶æ€æ¨¡å¼ä¸‹çš„ç½‘æ ¼å®½åº¦å€æ•°
width_multiplier_spike = 1.5  # Spike æ¨¡å¼ï¼šç½‘æ ¼æ”¾å¤§ 1.5x
width_multiplier_crush = 0.8  # Crush æ¨¡å¼ï¼šç½‘æ ¼æ”¶ç¼© 0.8x

# ğŸ’° èµ„é‡‘é…ç½®
initial_capital = 83.9    # åˆå§‹èµ„é‡‘ (USDC)

# ====== æ æ†ï¼ˆåˆçº¦ä¿è¯é‡‘å£å¾„ï¼Œéå€Ÿè´·ï¼‰======
# å£å¾„å®šä¹‰ï¼š
#   X = æŒä»“åä¹‰ä»·å€¼ï¼ˆå¸ä»“ä½ä»·å€¼ï¼‰
#   Y = ç©ºé—² USDT/USDCï¼ˆavailable balanceï¼‰
#   T = å ç”¨ä¿è¯é‡‘ï¼ˆused marginï¼‰
#   Z = é€ç¬”æ æ†ï¼ˆäº¤æ˜“æ‰€è®¾ç½® leverageï¼‰
#   ç›®æ ‡ï¼šå§‹ç»ˆç»´æŒ X ä¸ Y çš„ä»·å€¼æ¯”ä¾‹ä¸º 50/50ï¼ˆå³ X == Yï¼‰
#
# åœ¨è¯¥å£å¾„ä¸‹ï¼ˆå¿½ç•¥èµ„é‡‘è´¹/ç»´æŒä¿è¯é‡‘å·®å¼‚ï¼‰ï¼š
#   T = X / Z
#   Y = E - T
#   å¯è§£å¾—ï¼šX_target = E * Z / (Z + 1) ï¼›åä¹‰æ æ† W = (X+Y)/E = 2Z/(Z+1) < 2
#
# å‚æ•°äºŒé€‰ä¸€ï¼š
nominal_leverage = None     # åä¹‰æ æ† Wï¼ˆç­–ç•¥å±‚ï¼ŒèŒƒå›´ [1, 2)ï¼›ä¾‹ W=1.90 -> éœ€è¦ Z=19ï¼‰
position_leverage = 2.0     # é€ç¬”æ æ† Zï¼ˆäº¤æ˜“æ‰€ leverageï¼ŒèŒƒå›´ [1, ...]ï¼‰
max_position_leverage = 125 # é€ç¬”æ æ†ä¸Šé™ï¼ˆäº¤æ˜“æ‰€é™åˆ¶ï¼›è¶…å‡ºä¼šæŠ¥é”™ï¼‰

# è‹¥å¡«å†™ nominal_leverageï¼Œåˆ™è‡ªåŠ¨æ¢ç®—å‡º Zï¼ˆè¿™é‡Œé»˜è®¤ target_ratio å›ºå®š 0.5ï¼‰
if nominal_leverage is not None:
    w = float(nominal_leverage)
    if w < 1.0 or w >= 2.0:
        raise ValueError(f"nominal_leverage å¿…é¡»åœ¨ [1, 2) å†…, å½“å‰={w}")
    position_leverage = w / (2.0 - w)

if position_leverage > max_position_leverage:
    raise ValueError(f"position_leverage={position_leverage} è¶…è¿‡ max_position_leverage={max_position_leverage}")

# å…¼å®¹æ—§å­—æ®µï¼šleverage ä½œä¸º position_leverage çš„åˆ«å
leverage = float(position_leverage)

# ğŸ“… æ•°æ®èŒƒå›´
data_start_date = "2021-01-01"  # å›æµ‹èµ·å§‹æ—¥æœŸ

# ğŸ”‡ è°ƒè¯•é€‰é¡¹
verbose_regime_switch = False  # æ˜¯å¦æ‰“å°çŠ¶æ€åˆ‡æ¢æ—¥å¿— (True ä¼šåˆ·å±)

# ğŸ“ æ•°æ®æ–‡ä»¶è·¯å¾„ (ä¸€èˆ¬ä¸ç”¨æ”¹)
data_file = "/Users/chuan/Desktop/xiangmu/å®¢æˆ·ç«¯/Quant_Unified/ç­–ç•¥ä»“åº“/äºŒå·ç½‘æ ¼ç­–ç•¥/data_center/ETHUSDT_1m_2019-11-01_to_2025-06-15_table.h5"


# ==================== ä»¥ä¸‹æ˜¯é«˜çº§é…ç½®ï¼Œä¸€èˆ¬ä¸ç”¨æ”¹ ====================

# ç‰©ç†ä¸‹é™
min_grid_width_bps = 1   # æœ€å°ç½‘æ ¼å®½åº¦ (åŸºç‚¹, 5bps = 0.05%)

# æ³¢åŠ¨ç‡ K ç³»æ•°
vol_k_factor = 1.0

# ==================== å‚æ•°ä¼˜åŒ–æ¨èç»„åˆ ====================
"""
ğŸ† ä½å›æ’¤ç»„åˆ (é€‚åˆåŠ æ æ†):
    target_ratio = 0.2
    grid_width_base = 0.01
    é¢„æœŸ: å¹´åŒ– 12.7%, å›æ’¤ -25.7%, å¡ç› 0.50
    2xæ æ†: å¹´åŒ– 25.4%, å›æ’¤ -51.4%

ğŸ“Š å¹³è¡¡ç»„åˆ:
    target_ratio = 0.3
    grid_width_base = 0.008
    é¢„æœŸ: å¹´åŒ– 17.5%, å›æ’¤ -36.8%

ğŸ’° æ¿€è¿›ç»„åˆ:
    target_ratio = 0.5
    grid_width_base = 0.004
    é¢„æœŸ: å¹´åŒ– 26%, å›æ’¤ -54.7%
"""
